{% extends "main/base.html" %}

{% load static %}

{% block title %}Waiting Room {% endblock %}

{% block content %}

<h1><div align="center"><br>Hallo {{ user.username }}! <br>
   Bitte schlie√üen Du die Seite nicht!<br>
    Warten auf zweiten Spieler...<br>
<div class="spinner-border m-5" role="status">
  <span class="sr-only"></span>
</h1>
    <textarea id="chat-log" cols="100" rows="2"></textarea><br>
    {{ room_name|json_script:"room-name" }}
    <script>
        const roomName = JSON.parse(document.getElementById('room-name').textContent);

        // TODO: wss = https
        const socket = new WebSocket(
            'ws://'
            + window.location.host
            + '/ws/waiting_room/'
            + roomName
            + '/'
        );

        socket.onopen = function() {
               document.querySelector('#chat-log').value += document.getElementById('app').textContent;
               socket.send(JSON.stringify({
                'user': document.getElementById('app').textContent
            }));
        };

        socket.onclose = function(e) {
            console.error('Chat socket closed unexpectedly');
        };

        socket.onmessage = function(e) {
            const data = JSON.parse(e.data);
            console.log(data);
            document.querySelector('#chat-log').value += 'Users' + data.users;
            }

        document.querySelector('#btn').onclick = function(e) {
            const messageInput = document.getElementById('app').textContent;
            //const message = messageInput.value;
            socket.send(JSON.stringify({
                'user': messageInput
            }));
            messageInput.value = '';
        };


    </script>
{% endblock %}

{% block footer %}{% endblock %}